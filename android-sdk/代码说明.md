# Android SDK 代码说明

## 1. 目录结构

```
android-sdk/
├── src/
│   ├── main/
│   │   ├── java/
│   │   │   └── com/
│   │   │       └── adverge/
│   │   │           └── sdk/
│   │   │               ├── ad/           # 广告视图相关
│   │   │               ├── network/      # 网络请求相关
│   │   │               └── utils/        # 工具类
│   │   └── res/                          # 资源文件
├── build.gradle                          # 构建配置
└── 代码说明.md                           # 本文档
```

## 2. 核心类说明

### 2.1 AdServerClient

**位置**: `network/AdServerClient.java`

**功能**: 处理与广告服务器的网络通信

**主要方法**:
```java
public class AdServerClient {
    // 单例模式获取实例
    public static AdServerClient getInstance() {
        // ...
    }
    
    // 初始化 SDK
    public void init(Context context, String appId, String appKey) {
        // ...
    }
    
    // 发起广告请求
    public void requestAd(String adUnitId, AdRequestCallback callback) {
        // ...
    }
    
    // 上报广告展示
    public void trackImpression(String adUnitId) {
        // ...
    }
    
    // 上报广告点击
    public void trackClick(String adUnitId) {
        // ...
    }
}
```

**使用示例**:
```java
// 初始化
AdServerClient.getInstance().init(context, "your_app_id", "your_app_key");

// 请求广告
AdServerClient.getInstance().requestAd("banner_ad_unit", new AdRequestCallback() {
    @Override
    public void onSuccess(JSONObject response) {
        // 处理成功响应
    }
    
    @Override
    public void onError(String error) {
        // 处理错误
    }
});
```

### 2.2 AdView

**位置**: `ad/AdView.java`

**功能**: 广告视图的基类，定义了广告加载和展示的基本流程

**主要方法**:
```java
public abstract class AdView extends ViewGroup {
    // 设置广告单元 ID
    public void setAdUnitId(String adUnitId) {
        // ...
    }
    
    // 加载广告
    public void loadAd() {
        // ...
    }
    
    // 展示广告
    protected void showAd(View adView) {
        // ...
    }
    
    // 设置广告监听器
    public void setAdListener(AdListener listener) {
        // ...
    }
    
    // 由子类实现的广告加载方法
    protected abstract void loadAdWithAdapter(String source, JSONObject response);
}
```

### 2.3 BannerAdView

**位置**: `ad/BannerAdView.java`

**功能**: 横幅广告的具体实现

**主要方法**:
```java
public class BannerAdView extends AdView {
    // 设置广告尺寸
    public void setAdSize(AdSize adSize) {
        // ...
    }
    
    // 实现父类的抽象方法
    @Override
    protected void loadAdWithAdapter(String source, JSONObject response) {
        // ...
    }
    
    // 加载 TopOn 广告
    private void loadTopOnAd(JSONObject response) {
        // ...
    }
    
    // 加载 Mintegral 广告
    private void loadMintegralAd(JSONObject response) {
        // ...
    }
    
    // 加载 InMobi 广告
    private void loadInMobiAd(JSONObject response) {
        // ...
    }
}
```

## 3. 广告加载流程

1. **初始化 SDK**
   ```java
   // 在 Application 中初始化
   public class MyApplication extends Application {
       @Override
       public void onCreate() {
           super.onCreate();
           AdServerClient.getInstance().init(this, "your_app_id", "your_app_key");
       }
   }
   ```

2. **创建广告视图**
   ```java
   BannerAdView bannerAdView = new BannerAdView(context);
   bannerAdView.setAdSize(AdSize.BANNER);
   bannerAdView.setAdUnitId("your_ad_unit_id");
   ```

3. **设置监听器**
   ```java
   bannerAdView.setAdListener(new AdListener() {
       @Override
       public void onAdLoaded() {
           // 广告加载成功
       }
       
       @Override
       public void onAdFailedToLoad(LoadAdError error) {
           // 广告加载失败
       }
       
       @Override
       public void onAdClicked() {
           // 广告被点击
       }
   });
   ```

4. **加载广告**
   ```java
   bannerAdView.loadAd();
   ```

## 4. 错误处理

### 4.1 网络错误
- 检查网络连接状态
- 处理请求超时
- 处理服务器错误响应

### 4.2 广告加载错误
- 处理广告加载失败
- 处理广告展示失败
- 处理广告点击失败

### 4.3 数据解析错误
- 处理 JSON 解析错误
- 处理数据格式错误

## 5. 性能优化

### 5.1 网络优化
- 使用连接池
- 设置合理的超时时间
- 压缩请求数据

### 5.2 内存优化
- 及时释放不需要的资源
- 避免内存泄漏
- 使用弱引用

### 5.3 渲染优化
- 使用硬件加速
- 优化布局层级
- 避免过度绘制

## 6. 测试建议

### 6.1 单元测试
- 测试网络请求
- 测试数据解析
- 测试错误处理

### 6.2 集成测试
- 测试广告加载流程
- 测试广告展示
- 测试广告点击

### 6.3 性能测试
- 测试内存占用
- 测试 CPU 使用率
- 测试网络流量

## 7. 注意事项

1. **隐私合规**
   - 遵守 GDPR、CCPA 等隐私法规
   - 获取用户同意后再收集数据
   - 提供隐私政策说明

2. **版本兼容**
   - 支持 Android 4.4 及以上版本
   - 适配不同屏幕尺寸
   - 处理权限请求

3. **错误处理**
   - 提供详细的错误信息
   - 实现优雅降级
   - 记录错误日志

4. **性能优化**
   - 控制广告加载频率
   - 优化内存使用
   - 减少网络请求

## 8. 常见问题

### 8.1 广告加载失败
- 检查网络连接
- 检查广告单元 ID
- 检查 SDK 初始化

### 8.2 广告展示异常
- 检查布局参数
- 检查视图层级
- 检查生命周期

### 8.3 内存泄漏
- 检查 Activity 引用
- 检查静态变量
- 检查监听器注册

## 9. 更新日志

### v1.0.0 (2024-03-20)
- 初始版本发布
- 支持横幅广告
- 支持 TopOn、Mintegral、InMobi 平台

### v1.1.0 (计划中)
- 支持插屏广告
- 支持更多广告平台
- 优化性能
