你的公司计划开发一个广告聚合平台（Mediation Platform/SSP），对接多个广告平台（如 **Bigo Ads**、**InMobi**、**TopOn**、**Mintegral**、**Vungle**、**Fyber**、**Chartboost**、**ironSource**、**Unity Ads**、**Mahimeta**），以服务新闻网页应用（Web-based News Applications）为主的发布商客户。以下是一个详细的实施方案，涵盖需求分析、技术架构、实现细节、混合模型机制（Header Bidding + Waterfall）、收益优化策略，以及对新闻网页应用的定制化设计。方案确保对接所有指定广告平台，最大化收益和填充率，同时满足新闻应用的低延迟和高用户体验需求。

---

### 1. 需求分析

#### 1.1 客户群体：新闻网页应用
- **特点**：
  - **流量类型**：高 PV（页面浏览量），用户停留时间短，广告位以横幅（Banner）、原生广告（Native Ads）、插屏（Interstitial）、视频广告（Video Ads）为主。
  - **广告场景**：新闻内容页面、文章底部、侧边栏、页面切换时的插屏。
  - **用户体验要求**：低延迟（广告加载 < 200ms），高质量广告（品牌广告优先），避免侵入式广告（如全屏弹窗）。
  - **收益目标**：高 eCPM（每千次展示收益，目标 5-15 美元），高填充率（>95%）。
- **挑战**：
  - 新闻应用的 CPM（每千次展示成本）通常低于游戏应用的奖励视频（10-30 美元），需通过多平台竞价提升收益。
  - 网页环境对延迟敏感，需优化 Header Bidding 的竞价时间。
  - 需遵守隐私法规（如 GDPR、CCPA），确保用户数据合规。

#### 1.2 广告平台对接需求
- **指定平台**：
  - **Bigo Ads**：专注于东南亚和新兴市场，适合横幅和视频广告。
  - **InMobi**：全球移动广告平台，强于原生广告和品牌广告，客户包括 Lenovo、Mastercard 等。[](https://www.businessofapps.com/ads/mobile-ad-network/)
  - **TopOn**：广告交易平台（Ad Exchange），支持 RTB（实时竞价），连接多 DSP（如 InMobi DSP）。
  - **Mintegral**：游戏和品牌广告强，亚太市场表现优异，适合视频和原生广告。
  - **Vungle (Liftoff Monetize)**：视频广告专家，高填充率，适合插屏和视频。
  - **Fyber (Digital Turbine)**：移动广告平台，支持多种广告格式，适合横幅和原生。
  - **Chartboost**：游戏广告平台，适合插屏和视频，可用于新闻应用的交叉推广。
  - **ironSource (Unity LevelPlay)**：聚合平台，强于视频和插屏，高填充率。
  - **Unity Ads**：游戏类广告，适合视频广告，Unity 引擎网页应用兼容性好。
  - **Mahimeta**：新兴广告平台，专注于印度市场，适合横幅和原生广告。
- **对接要求**：
  - 集成各平台的 SDK（Web SDK 或 API）或适配器（Adapters）。
  - 支持 Header Bidding（通过 RTB）和 Waterfall 模型。
  - 提供统一管理界面，展示 eCPM、填充率、延迟等数据。

#### 1.3 平台目标
- **收益最大化**：通过 Header Bidding 挖掘最高 eCPM，Waterfall 确保填充率。
- **低延迟**：竞价和广告加载总延迟 < 200ms，适合新闻网页的快速加载需求。
- **灵活性**：支持多种广告格式（横幅、原生、插屏、视频），适应不同新闻应用。
- **合规性**：遵守 GDPR、CCPA，集成 CMP（Consent Management Platform）获取用户同意。
- **可扩展性**：支持新增广告平台（如 PubMatic、Meta Audience Network）。

---

### 2. 技术架构

#### 2.1 系统架构
```
[News Web Application]
    |
[Your Mediation Platform]
    |--> [Web SDK] (Header Bidding + Waterfall)
    |       |--> Adapters: Bigo Ads, InMobi, TopOn, Mintegral, Vungle, Fyber, Chartboost, ironSource, Unity Ads, Mahimeta
    |       |--> RTB Module (OpenRTB for Header Bidding)
    |       |--> CMP (Consent Management for GDPR/CCPA)
    |
    |--> [Backend]
    |       |--> API Server (Node.js + Express)
    |       |--> Message Queue (Kafka for high concurrency)
    |       |--> Database (MongoDB for metrics, Redis for caching)
    |       |--> Analytics Engine (eCPM, fill rate, latency)
    |
    |--> [Dashboard]
            |--> Publisher Interface (Strategy selection, Metrics)
            |--> A/B Testing Module (Header Bidding vs Waterfall)
```

- **Web SDK**：轻量级 JavaScript SDK，集成所有广告平台的适配器，支持 Header Bidding 和 Waterfall。
- **Backend**：处理竞价请求、记录数据、优化策略。
- **Dashboard**：Web 界面，供发布商配置策略、查看收益数据。

#### 2.2 广告格式支持
- **横幅（Banner）**：300x250, 728x90，适合文章侧边栏、底部。
- **原生广告（Native Ads）**：融入新闻内容，减少用户干扰。
- **插屏（Interstitial）**：页面切换时展示，适合高 eCPM。
- **视频广告（Video Ads）**：15-30 秒，嵌入文章或插屏，eCPM 高。

#### 2.3 技术栈
- **前端**：JavaScript (ES6), Prebid.js (Header Bidding), React (Dashboard).
- **后端**：Node.js + Express (API), Kafka (消息队列), MongoDB (数据存储), Redis (缓存).
- **协议**：OpenRTB (RTB for Header Bidding), IAB TCF 2.0 (GDPR).
- **部署**：AWS (EC2, S3, CloudFront), Docker + Kubernetes (高可用).

---

### 3. 混合模型机制

基于新闻网页应用的特点，平台采用 **Header Bidding + Waterfall** 的混合模型机制，结合 **RTB** 技术，优化收益和填充率。

#### 3.1 Header Bidding
- **功能**：
  - 同时向多个广告平台（Bigo Ads, InMobi, TopOn, Mintegral 等）发起 RTB 竞价，选择 eCPM 最高的广告。
  - 使用 Prebid.js（行业标准 Web Header Bidding 库）实现客户端竞价。
- **适用场景**：
  - 高流量新闻网站（PV > 100 万/天），如大型新闻门户。
  - 高价值广告位，如插屏和视频广告（eCPM 5-15 美元）。
- **实现**：
  - SDK 调用各平台的竞价接口（如 TopOn 的 OpenRTB、Mintegral 的 Bid API）。
  - 竞价时间控制在 100-150ms，减少页面加载延迟。
- **示例**：
  - 新闻页面加载插屏广告，SDK 向 TopOn ADX（eCPM 10 美元）、Mintegral（8 美元）、InMobi（7 美元）竞价，选择 TopOn ADX 的广告。

#### 3.2 Waterfall
- **功能**：
  - 按历史 eCPM 优先级依次尝试广告平台（如 ironSource、Unity Ads、Vungle）。
  - 支持非 RTB 请求（如 Unity Ads 的 API）。
- **适用场景**：
  - 中小型新闻网站（PV < 50 万/天），流量不足以吸引多 DSP 竞价。
  - 低延迟广告位，如横幅（需 < 100ms 加载）。
- **实现**：
  - SDK 按优先级调用适配器的 `bid` 方法，失败后尝试下一个。
  - 管理界面允许发布商调整优先级（如 ironSource > Vungle）。
- **示例**：
  - 小型新闻网站加载横幅广告，先尝试 ironSource（eCPM 4 美元），失败后再尝试 Unity Ads（3 美元）。

#### 3.3 混合机制
- **动态选择**：
  - 发布商通过仪表板选择 Header Bidding（高流量）或 Waterfall（中小流量）。
  - SDK 支持动态切换（基于流量、延迟、eCPM 数据）。
- **后备机制**：
  - Header Bidding 失败（无有效出价或超时）时，自动切换到 Waterfall。
  - 示例：TopOn ADX 和 Mintegral 无广告，SDK 尝试 ironSource、Vungle。
- **RTB 集成**：
  - Header Bidding 使用 RTB（TopOn, Mintegral, InMobi）。
  - Waterfall 混合 RTB（ironSource 可选）和非 RTB（Unity Ads, Vungle）。

---

### 4. 实现细节

#### 4.1 Web SDK 开发
- **功能**：
  - 集成所有广告平台（Bigo Ads, InMobi, TopOn, Mintegral, Vungle, Fyber, Chartboost, ironSource, Unity Ads, Mahimeta）的 Web 适配器。
  - 支持 Header Bidding（基于 Prebid.js）和 Waterfall。
  - 集成 CMP（如 OneTrust）确保 GDPR/CCPA 合规。
- **代码示例**（JavaScript）：
```javascript
class AdAggregator {
  constructor(config) {
    this.config = config; // 配置包括 Bigo Ads, InMobi, TopOn 等
    this.adSources = [];
    this.init();
  }

  init() {
    // 初始化广告来源
    this.adSources.push(
      new BigoAdsAdapter(this.config.bigoAds),
      new InmobiAdapter(this.config.inmobi),
      new TopOnAdapter(this.config.topon),
      new MintegralAdapter(this.config.mintegral),
      new VungleAdapter(this.config.vungle),
      new FyberAdapter(this.config.fyber),
      new ChartboostAdapter(this.config.chartboost),
      new IronSourceAdapter(this.config.ironSource),
      new UnityAdsAdapter(this.config.unityAds),
      new MahimetaAdapter(this.config.mahimeta)
    );
    // 按历史 eCPM 排序（用于 Waterfall）
    this.adSources.sort((a, b) => (b.historicalEcpm || 0) - (a.historicalEcpm || 0));
  }

  // 广告请求入口
  async requestAd(placementId, strategy = 'headerBidding') {
    if (!this.checkConsent()) throw new Error('用户未同意隐私政策');
    if (strategy === 'headerBidding') {
      return this.requestAdHeaderBidding(placementId);
    } else if (strategy === 'waterfall') {
      return this.requestAdWaterfall(placementId);
    }
    throw new Error('无效的策略');
  }

  // 头部竞价模式
  async requestAdHeaderBidding(placementId) {
    const bids = await Promise.all(
      this.adSources.map(source => source.bid(placementId))
    );
    const winningBid = bids.reduce((max, bid) => 
      bid && bid.price > (max?.price || 0) ? bid : max, null
    );
    if (winningBid) {
      this.reportMetrics(winningBid);
      return winningBid.render();
    }
    // 后备：切换到瀑布流
    return this.requestAdWaterfall(placementId);
  }

  // 瀑布流模式
  async requestAdWaterfall(placementId) {
    for (const source of this.adSources) {
      const bid = await source.bid(placementId);
      if (bid) {
        this.reportMetrics(bid);
        return bid.render();
      }
    }
    throw new Error('无有效出价');
  }

  // 检查用户隐私同意
  checkConsent() {
    return window.CMP && window.CMP.hasConsent(); // 假设使用 OneTrust CMP
  }

  // 报告收益数据
  reportMetrics(bid) {
    fetch('/api/report', {
      method: 'POST',
      body: JSON.stringify({
        placementId: bid.placementId,
        source: bid.source,
        ecpm: bid.price,
        timestamp: Date.now()
      })
    });
  }
}

// 示例适配器（以 Mintegral 为例）
class MintegralAdapter {
  constructor(config) {
    this.config = config;
  }

  async bid(placementId) {
    try {
      const response = await fetch(this.config.apiUrl, {
        method: 'POST',
        body: JSON.stringify({
          placementId,
          appKey: this.config.appKey,
          userData: { geo: 'US', category: 'news' }
        })
      });
      const bid = await response.json();
      return {
        source: 'Mintegral',
        price: bid.ecpm,
        placementId,
        render: () => this.renderAd(bid.creative)
      };
    } catch (e) {
      return null;
    }
  }

  renderAd(creative) {
    const adElement = document.createElement('div');
    adElement.innerHTML = creative.html; // 假设 creative 提供 HTML 片段
    return adElement;
  }
}

// 使用示例
const aggregator = new AdAggregator({
  bigoAds: { appKey: 'bigo-key', apiUrl: 'https://api.bigo.ads' },
  inmobi: { appKey: 'inmobi-key', apiUrl: 'https://api.inmobi.com' },
  topon: { appId: 'topon-app', apiUrl: 'https://adx.topon.com' },
  mintegral: { appKey: 'mintegral-key', apiUrl: 'https://ssp.mintegral.com' },
  vungle: { appId: 'vungle-app', apiUrl: 'https://api.vungle.com' },
  fyber: { appKey: 'fyber-key', apiUrl: 'https://api.fyber.com' },
  chartboost: { appId: 'chartboost-app', apiUrl: 'https://api.chartboost.com' },
  ironSource: { appKey: 'ironSource-key', apiUrl: 'https://api.ironsource.com' },
  unityAds: { gameId: 'unity-game', apiUrl: 'https://api.unityads.com' },
  mahimeta: { appKey: 'mahimeta-key', apiUrl: 'https://api.mahimeta.com' }
});

aggregator.requestAd('banner-123').then(ad => {
  document.getElementById('ad-container').appendChild(ad);
}).catch(err => {
  console.error('广告加载失败:', err);
});
```
- **说明**：
  - SDK 初始化所有广告平台的适配器，支持 RTB（TopOn, Mintegral）和非 RTB（Unity Ads, Vungle）。
  - `requestAd` 方法支持 Header Bidding 和 Waterfall，失败时自动切换。
  - 集成 CMP 检查用户隐私同意，确保合规。

#### 4.2 后端开发
- **功能**：
  - 处理竞价请求、记录数据、优化策略。
  - 支持服务器端 Header Bidding（可选，降低客户端延迟）。
- **API 示例**（Node.js + Express）：
```javascript
const express = require('express');
const app = express();
app.use(express.json());

// 记录竞价数据
app.post('/api/report', async (req, res) => {
  const { placementId, source, ecpm, timestamp } = req.body;
  await db.collection('metrics').insertOne({ placementId, source, ecpm, timestamp });
  res.status(200).send('已记录');
});

// 服务器端竞价（可选）
app.post('/api/server-bid', async (req, res) => {
  const { placementId, userData } = req.body;
  const bids = await Promise.all([
    bidMintegral(placementId, userData),
    bidTopOn(placementId, userData)
  ]);
  const winningBid = bids.reduce((max, bid) => 
    bid && bid.ecpm > (max?.ecpm || 0) ? bid : max, null
  );
  res.json(winningBid || {});
});

app.listen(3000, () => console.log('服务器运行在 3000 端口'));
```
- **组件**：
  - **Kafka**：处理高并发竞价请求（每日 1000 万+）。
  - **MongoDB**：存储 eCPM、填充率、延迟数据。
  - **Redis**：缓存 TopOn ADX 的 DSP 出价，降低延迟。

#### 4.3 管理仪表板
- **功能**：
  - 配置广告平台优先级（Waterfall）或竞价参与方（Header Bidding）。
  - 实时展示 eCPM、填充率、延迟数据。
  - 支持 A/B 测试（Header Bidding vs Waterfall）。
- **示例数据**：
  - TopOn ADX：eCPM 10 美元，填充率 95%。
  - Mintegral：eCPM 8 美元，填充率 90%。
  - ironSource：eCPM 6 美元，填充率 98%。

#### 4.4 合规性
- **隐私合规**：
  - 集成 OneTrust CMP，获取用户同意（GDPR、CCPA）。
  - 在竞价请求中仅发送匿名化用户数据（如地区、兴趣）。
- **app-ads.txt**：
  - 要求发布商配置 app-ads.txt，验证 Bigo Ads、InMobi 等来源的合法性。

---

### 5. 收益优化策略

#### 5.1 广告平台选择
- **高 eCPM 平台**：
  - **TopOn ADX**：多 DSP 竞价，适合插屏和视频（eCPM 8-15 美元）。
  - **Mintegral**：品牌和游戏广告，亚太市场强（eCPM 6-12 美元）。
  - **InMobi**：原生广告专家，品牌广告 eCPM 高（5-10 美元）。[](https://www.businessofapps.com/ads/mobile-ad-network/)
- **高填充率平台**：
  - **ironSource**：稳定填充率（98%+），适合横幅和插屏。
  - **Unity Ads**：视频广告填充率高，适合新闻应用。
  - **Vungle**：视频广告备用来源。
- **区域优化**：
  - 东南亚：优先 Bigo Ads、Mahimeta。
  - 欧美：优先 InMobi、ironSource。
  - 亚太：优先 Mintegral、TopOn ADX。

#### 5.2 动态策略
- **AI 驱动优化**：
  - 使用机器学习模型，根据实时 eCPM 和填充率动态调整 Header Bidding 参与方或 Waterfall 优先级。
  - 示例：若 TopOn ADX 的 eCPM 持续高于 Mintegral，增加其竞价权重。
- **A/B 测试**：
  - 比较 Header Bidding（TopOn, Mintegral, InMobi）和 Waterfall（ironSource, Unity Ads）的收益。
  - 示例：高流量站点测试 Header Bidding 提升 eCPM 30%，但延迟增加 50ms。

#### 5.3 延迟优化
- **客户端优化**：
  - 使用 Prebid.js 的异步竞价，控制 Header Bidding 超时（150ms）。
  - 缓存广告创意（Creative Caching），减少重复请求。
- **服务器端竞价**：
  - 集成 TopOn ADX 的 Server-Side Header Bidding，竞价在服务器完成，延迟 < 100ms。
- **CDN**：
  - 使用 AWS CloudFront 分发广告内容，降低加载时间。

#### 5.4 广告质量
- **品牌广告优先**：
  - 配置 InMobi、Mintegral 优先提供品牌广告（如 L'Oréal、Mastercard），提升用户体验。[](https://www.businessofapps.com/ads/mobile-ad-network/)
- **广告审查**：
  - 过滤低质量广告（如赌博、成人内容），确保新闻应用的内容安全。

---

### 6. 实施方案

#### 6.1 开发计划
- **阶段 1（1 个月）**：SDK 开发
  - 集成 Bigo Ads, InMobi, TopOn, Mintegral 的适配器。
  - 实现 Header Bidding（Prebid.js）和 Waterfall。
  - 集成 CMP（OneTrust）确保合规。
- **阶段 2（2个月）**：后端和仪表板
  - 开发 API 服务器（Node.js）、消息队列（Kafka）、数据库（MongoDB, Redis）。
  - 构建管理仪表板（React），支持策略配置和数据展示。
- **阶段 3（1个月）**：测试和优化
  - 与 5-10 家新闻应用 Beta 测试，收集 eCPM、填充率数据。
  - 优化延迟（目标 < 200ms），A/B 测试 Header Bidding vs Waterfall。
- **阶段 4（2 个月）**：全面上线
  - 集成剩余平台（Vungle, Fyber, Chartboost, ironSource, Unity Ads, Mahimeta）。
  - 推广平台，吸引 50+ 新闻应用客户。

#### 6.2 资源需求
- **团队**：
  - 前端开发（2 人）：SDK 和仪表板。
  - 后端开发（2 人）：API 和数据库。
  - 数据分析师（1 人）：eCPM 和填充率优化。
  - 产品经理（1 人）：需求和推广。

#### 6.3 预期收益
- **假设**：
  - 新闻应用客户：50 家，平均 PV 100 万/天。
  - 广告位：3 个/页面（横幅、原生、插屏）。
  - 平均 eCPM：8 美元，填充率 95%。
- **计算**：
  - 每日展示量：50 * 1M * 3 * 0.95 = 142.5M。
  - 每日收入：(142.5M / 1000) * 8 = 1.14M 美元。
  - 平台分成（30%）：1.14M * 0.3 ≈ 342,000 美元/天。
  - 年收入：342,000 * 365 ≈ 1.25 亿美元。

---

### 7. 新闻应用的定制化设计

#### 7.1 广告位优化
- **横幅**：
  - 放置在文章顶部、侧边栏、底部，尺寸 300x250 或 728x90。
  - 优先 InMobi、ironSource（高填充率，低干扰）。
- **原生广告**：
  - 嵌入新闻列表，模仿文章卡片样式。
  - 优先 InMobi、Mintegral（品牌广告，eCPM 高）。
- **插屏**：
  - 在文章切换或页面刷新时触发，频率控制（每用户每日 ≤ 3 次）。
  - 优先 TopOn ADX、Mintegral（高 eCPM）。
- **视频广告**：
  - 嵌入文章或作为插屏，15-30 秒。
  - 优先 Vungle、Unity Ads（高填充率）。

#### 7.2 用户体验
- **低延迟**：
  - Header Bidding 超时设为 150ms，Waterfall 每来源 50ms。
  - 使用 CDN 和创意缓存，广告加载 < 200ms。
- **广告频率控制**：
  - 配置广告展示上限（例如，每 5 分钟 1 次插屏）。
  - 提供用户关闭广告选项，符合 GDPR。
- **内容相关性**：
  - 根据新闻类别（政治、科技、娱乐）匹配广告。
  - 示例：科技新闻优先 InMobi 的 Samsung 广告。[](https://www.businessofapps.com/ads/mobile-ad-network/)

#### 7.3 区域优化
- **北美/欧洲**：
  - 优先 InMobi、ironSource、TopOn ADX（品牌广告，eCPM 8-15 美元）。
  - 高隐私要求，严格执行 GDPR/CCPA。
- **亚太（含东南亚）**：
  - 优先 Mintegral、Bigo Ads、Mahimeta（本地化广告，eCPM 5-10 美元）。
  - 视频和原生广告需求高。
- **印度**：
  - 优先 Mahimeta、InMobi（低成本高填充率，eCPM 3-8 美元）。
  - 横幅和原生广告为主。

---

### 8. 风险与应对

#### 8.1 风险
- **延迟过高**：
  - Header Bidding 的并行竞价可能增加 100-200ms 延迟，影响新闻页面加载。
- **填充率不足**：
  - 小型新闻应用流量低，部分平台（如 TopOn ADX）出价不足。
- **合规风险**：
  - GDPR/CCPA 违规可能导致罚款或广告主撤资。
- **平台分成**：
  - 广告平台（如 ironSource、TopOn）抽成 20-30%，降低净收入。

#### 8.2 应对
- **延迟优化**：
  - 实施服务器端 Header Bidding（TopOn ADX 支持）。
  - 限制 Header Bidding 参与方（3-5 个，如 TopOn, Mintegral, InMobi）。
- **填充率提升**：
  - 增加高填充率平台（如 ironSource、Vungle）到 Waterfall。
  - 动态调整 Header Bidding 和 Waterfall 的切换阈值。
- **合规保障**：
  - 集成 OneTrust CMP，强制用户同意。
  - 定期审计 app-ads.txt 和隐私政策。
- **成本控制**：
  - 谈判广告平台分成比例（目标 < 25%）。
  - 优化服务器成本（AWS 按需扩容）。

---

### 9. 广告平台配置示例

#### 9.1 统一配置示例

```java
public class AdConfig {
    private String appId;
    private String appKey;
    private boolean testMode;
    private Map<String, PlatformConfig> platformConfigs;

    private AdConfig(Builder builder) {
        this.appId = builder.appId;
        this.appKey = builder.appKey;
        this.testMode = builder.testMode;
        this.platformConfigs = builder.platformConfigs;
    }

    public String getAppId() {
        return appId;
    }

    public String getAppKey() {
        return appKey;
    }

    public boolean isTestMode() {
        return testMode;
    }

    public PlatformConfig getPlatformConfig(String platform) {
        return platformConfigs.get(platform);
    }

    public static class Builder {
        private String appId;
        private String appKey;
        private boolean testMode = false;
        private Map<String, PlatformConfig> platformConfigs = new HashMap<>();

        public Builder setAppId(String appId) {
            this.appId = appId;
            return this;
        }

        public Builder setAppKey(String appKey) {
            this.appKey = appKey;
            return this;
        }

        public Builder setTestMode(boolean testMode) {
            this.testMode = testMode;
            return this;
        }

        public Builder addPlatformConfig(String platform, PlatformConfig config) {
            this.platformConfigs.put(platform, config);
            return this;
        }

        public AdConfig build() {
            return new AdConfig(this);
        }
    }
}

public class PlatformConfig {
    private String appId;
    private String appKey;
    private String placementId;
    private Map<String, Object> extraParams;

    private PlatformConfig(Builder builder) {
        this.appId = builder.appId;
        this.appKey = builder.appKey;
        this.placementId = builder.placementId;
        this.extraParams = builder.extraParams;
    }

    public String getAppId() {
        return appId;
    }

    public String getAppKey() {
        return appKey;
    }

    public String getPlacementId() {
        return placementId;
    }

    public Map<String, Object> getExtraParams() {
        return extraParams;
    }

    public static class Builder {
        private String appId;
        private String appKey;
        private String placementId;
        private Map<String, Object> extraParams = new HashMap<>();

        public Builder setAppId(String appId) {
            this.appId = appId;
            return this;
        }

        public Builder setAppKey(String appKey) {
            this.appKey = appKey;
            return this;
        }

        public Builder setPlacementId(String placementId) {
            this.placementId = placementId;
            return this;
        }

        public Builder addExtraParam(String key, Object value) {
            this.extraParams.put(key, value);
            return this;
        }

        public PlatformConfig build() {
            return new PlatformConfig(this);
        }
    }
}
```

#### 9.2 配置使用示例

```java
// 在Application中初始化配置
public class MyApplication extends Application {
    @Override
    public void onCreate() {
        super.onCreate();
        
        // 创建广告平台配置
        AdConfig config = new AdConfig.Builder()
            .setAppId("your_app_id")
            .setAppKey("your_app_key")
            .setTestMode(true)
            
            // IronSource配置
            .addPlatformConfig("ironsource", new PlatformConfig.Builder()
                .setAppId("ironsource_app_id")
                .setAppKey("ironsource_app_key")
                .addExtraParam("userId", "user123")
                .build())
            
            // Mintegral配置
            .addPlatformConfig("mintegral", new PlatformConfig.Builder()
                .setAppId("mintegral_app_id")
                .setAppKey("mintegral_app_key")
                .setPlacementId("mintegral_placement_id")
                .build())
            
            // Pangle配置
            .addPlatformConfig("pangle", new PlatformConfig.Builder()
                .setAppId("pangle_app_id")
                .setAppKey("pangle_app_key")
                .build())
            
            // AppLovin配置
            .addPlatformConfig("applovin", new PlatformConfig.Builder()
                .setAppId("applovin_app_id")
                .setAppKey("applovin_app_key")
                .build())
            
            // Unity配置
            .addPlatformConfig("unity", new PlatformConfig.Builder()
                .setAppId("unity_app_id")
                .setAppKey("unity_app_key")
                .build())
            
            // Mahimeta配置
            .addPlatformConfig("mahimeta", new PlatformConfig.Builder()
                .setAppId("mahimeta_app_id")
                .setAppKey("mahimeta_app_key")
                .build())
            
            .build();

        // 初始化广告聚合SDK
        AdAggregator.getInstance().init(this, config);
  }
}
```

#### 9.3 配置获取示例

```java
// 在适配器中使用配置
public class IronSourceAdapter implements AdPlatformAdapter {
    private PlatformConfig config;

    public IronSourceAdapter(PlatformConfig config) {
        this.config = config;
    }

    @Override
    public void init(Context context) {
        // 使用配置初始化IronSource SDK
        IronSource.setUserId(config.getExtraParams().get("userId").toString());
        IronSource.init(context, config.getAppKey());
    }
}

// 在广告聚合SDK中使用配置
public class AdAggregator {
    private static AdAggregator instance;
    private AdConfig config;
    private Map<String, AdPlatformAdapter> adapters = new HashMap<>();

    public static AdAggregator getInstance() {
        if (instance == null) {
            instance = new AdAggregator();
        }
        return instance;
    }

    public void init(Context context, AdConfig config) {
        this.config = config;
        
        // 初始化所有广告平台适配器
        for (Map.Entry<String, PlatformConfig> entry : config.getPlatformConfigs().entrySet()) {
            String platform = entry.getKey();
            PlatformConfig platformConfig = entry.getValue();
            
            AdPlatformAdapter adapter = createAdapter(platform, platformConfig);
            if (adapter != null) {
                adapter.init(context);
                adapters.put(platform, adapter);
            }
        }
    }

    private AdPlatformAdapter createAdapter(String platform, PlatformConfig config) {
        switch (platform) {
            case "ironsource":
                return new IronSourceAdapter(config);
            case "mintegral":
                return new MintegralAdapter(config);
            case "pangle":
                return new PangleAdapter(config);
            case "applovin":
                return new AppLovinAdapter(config);
            case "unity":
                return new UnityAdapter(config);
            case "mahimeta":
                return new MahimetaAdapter(config);
            default:
                return null;
        }
    }
}
```

---

### 10. 总结

本方案为你的广告聚合平台提供了全面的设计，专为新闻网页应用优化：
- **混合模型**：Header Bidding（TopOn, Mintegral, InMobi）最大化 eCPM，Waterfall（ironSource, Unity Ads, Vungle）确保填充率。
- **广告平台**：对接 Bigo Ads、InMobi、TopOn、Mintegral、Vungle、Fyber、Chartboost、ironSource、Unity Ads、Mahimeta，覆盖全球市场。
- **技术实现**：Web SDK（Prebid.js）、Node.js 后端、React 仪表板，延迟 < 200ms。
- **收益预期**：年收入 1.25 亿美元（50 家客户，eCPM 8 美元）。
- **新闻应用优化**：优先品牌广告（InMobi）、低延迟（CDN）、合规（GDPR）。

如果需要进一步细化（例如，特定广告平台的 API 集成、详细预算、或针对某地区的优化），请提供更多细节，我可以更新方案或提供新 artifact！

## 使用说明

### 1. 集成步骤

#### 1.1 添加依赖
在项目的 `build.gradle` 文件中添加以下依赖：

```groovy
dependencies {
    // 广告聚合SDK
    implementation 'com.adverge.sdk:core:1.0.0'
    
    // 各广告平台SDK
    implementation 'com.ironsource.sdk:mediationsdk:7.5.1'
    implementation 'com.bigo.sdk:ads:1.0.0'
    implementation 'com.inmobi.sdk:inmobi-ads:10.1.4'
    implementation 'com.topon.sdk:core:1.0.0'
    implementation 'com.vungle.sdk:ads:6.12.1'
    implementation 'com.chartboost.sdk:ads:9.3.1'
    implementation 'com.mintegral.sdk:ads:16.4.41'
    implementation 'com.fyber.sdk:ads:8.2.1'
    implementation 'com.unity3d.ads:unity-ads:4.9.1'
    implementation 'com.mahimeta.sdk:core:1.0.0'
    implementation 'com.mahimeta.sdk:rewarded:1.0.0'
    implementation 'com.mahimeta.sdk:interstitial:1.0.0'
    implementation 'com.mahimeta.sdk:banner:1.0.0'
}
```

#### 1.2 初始化SDK
在 Application 类中初始化广告聚合SDK：

```java
public class MyApplication extends Application {
    @Override
    public void onCreate() {
        super.onCreate();
        
        // 初始化广告聚合SDK
        AdAggregator.getInstance().init(this, new AdConfig.Builder()
            .setAppId("your_app_id")
            .setAppKey("your_app_key")
            .setTestMode(true) // 测试模式
            .build());
    }
}
```

### 2. 广告类型使用示例

#### 2.1 横幅广告
```java
// 创建广告请求
AdRequest request = new AdRequest.Builder()
    .setAdUnitId("your_ad_unit_id")
    .setAdType(AdType.BANNER)
    .setAdSize(AdSize.BANNER)
    .build();

// 加载广告
AdAggregator.getInstance().loadAd(request, new AdListener() {
    @Override
    public void onAdLoaded() {
        // 广告加载成功
    }

    @Override
    public void onAdLoadFailed(String error) {
        // 广告加载失败
    }

    @Override
    public void onAdClicked() {
        // 广告被点击
    }

    @Override
    public void onAdOpened() {
        // 广告展示
    }

    @Override
    public void onAdClosed() {
        // 广告关闭
    }
});

// 展示广告
AdAggregator.getInstance().showAd();
```

#### 2.2 插页广告
```java
// 创建广告请求
AdRequest request = new AdRequest.Builder()
    .setAdUnitId("your_ad_unit_id")
    .setAdType(AdType.INTERSTITIAL)
    .build();

// 加载广告
AdAggregator.getInstance().loadAd(request, new AdListener() {
    @Override
    public void onAdLoaded() {
        // 广告加载成功
    }

    @Override
    public void onAdLoadFailed(String error) {
        // 广告加载失败
    }

    @Override
    public void onAdClicked() {
        // 广告被点击
    }

    @Override
    public void onAdOpened() {
        // 广告展示
    }

    @Override
    public void onAdClosed() {
        // 广告关闭
    }
});

// 展示广告
AdAggregator.getInstance().showAd();
```

#### 2.3 激励视频广告
```java
// 创建广告请求
AdRequest request = new AdRequest.Builder()
    .setAdUnitId("your_ad_unit_id")
    .setAdType(AdType.REWARDED)
    .build();

// 加载广告
AdAggregator.getInstance().loadAd(request, new AdListener() {
    @Override
    public void onAdLoaded() {
        // 广告加载成功
    }

    @Override
    public void onAdLoadFailed(String error) {
        // 广告加载失败
    }

    @Override
    public void onAdClicked() {
        // 广告被点击
    }

    @Override
    public void onAdOpened() {
        // 广告展示
    }

    @Override
    public void onAdClosed() {
        // 广告关闭
    }

    @Override
    public void onAdRewarded() {
        // 广告奖励发放
    }
});

// 展示广告
AdAggregator.getInstance().showAd();
```

### 3. 高级功能

#### 3.1 自定义广告请求策略
```java
// 设置Header Bidding策略
AdAggregator.getInstance().setRequestStrategy(RequestStrategy.HEADER_BIDDING);

// 设置Waterfall策略
AdAggregator.getInstance().setRequestStrategy(RequestStrategy.WATERFALL);
```

#### 3.2 设置广告平台优先级
```java
// 设置广告平台优先级
AdAggregator.getInstance().setPlatformPriority(Arrays.asList(
    "ironsource",
    "mintegral",
    "pangle",
    "applovin",
    "unity",
    "mahimeta"
));
```

#### 3.3 获取广告平台信息
```java
// 获取所有支持的广告平台
List<String> platforms = AdAggregator.getInstance().getSupportedPlatforms();

// 获取广告平台的历史eCPM
double ecpm = AdAggregator.getInstance().getPlatformEcpm("ironsource");
```

### 4. 注意事项

1. 确保在 AndroidManifest.xml 中添加必要的权限：
```xml
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />
```

2. 测试阶段建议开启测试模式：
```java
AdConfig config = new AdConfig.Builder()
    .setTestMode(true)
    .build();
```

3. 发布前请关闭测试模式并确保所有广告平台配置正确。

4. 建议在应用启动时预加载广告，以提高广告展示的成功率。

5. 注意处理广告加载失败的情况，可以设置重试机制或降级策略。

6. 定期检查广告平台的更新，及时更新SDK版本。

### 5. 常见问题

1. Q: 广告加载失败怎么办？
   A: 检查网络连接、广告单元ID是否正确、广告平台配置是否完整。

2. Q: 如何提高广告填充率？
   A: 可以设置多个广告平台，使用Header Bidding策略，并合理设置广告平台优先级。

3. Q: 如何优化广告收益？
   A: 定期分析各平台的eCPM数据，调整平台优先级，优化广告展示时机。

4. Q: 如何处理用户隐私？
   A: 确保遵守GDPR等隐私法规，在初始化SDK前获取用户同意。

5. Q: 如何调试广告问题？
   A: 开启测试模式，查看日志输出，使用各平台提供的测试广告单元ID。

### 6. 代码示例

#### 6.1 基础配置示例

```java
// 配置广告平台参数
Map<String, Object> config = new HashMap<>();
config.put("appId", "your_app_id");
config.put("appKey", "your_app_key");
config.put("testMode", true);

// 初始化广告聚合SDK
AdAggregator.getInstance().init(context, config);

// 设置广告平台优先级
List<String> priorityList = Arrays.asList(
    "ironsource",
    "mintegral",
    "pangle",
    "applovin",
    "unity",
    "mahimeta"
);
AdAggregator.getInstance().setPlatformPriority(priorityList);
```

#### 6.2 广告加载和展示示例

```java
// 创建广告请求
AdRequest request = new AdRequest.Builder()
    .setAdUnitId("your_ad_unit_id")
    .setAdType(AdType.BANNER)
    .setAdSize(AdSize.BANNER)
    .setTestMode(true) // 测试模式
    .setUserData(new UserData.Builder()
        .setAge(25)
        .setGender("male")
        .setLocation("CN")
        .build())
    .build();

// 加载广告
AdAggregator.getInstance().loadAd(request, new AdListener() {
    @Override
    public void onAdLoaded() {
        Log.d(TAG, "广告加载成功");
        // 展示广告
        AdAggregator.getInstance().showAd();
    }

    @Override
    public void onAdLoadFailed(String error) {
        Log.e(TAG, "广告加载失败: " + error);
        // 重试加载
        retryLoadAd();
    }

    @Override
    public void onAdClicked() {
        Log.d(TAG, "广告被点击");
        // 处理点击事件
        handleAdClick();
    }

    @Override
    public void onAdOpened() {
        Log.d(TAG, "广告展示");
        // 暂停游戏或视频
        pauseGame();
    }

    @Override
    public void onAdClosed() {
        Log.d(TAG, "广告关闭");
        // 恢复游戏或视频
        resumeGame();
    }

    @Override
    public void onAdRewarded() {
        Log.d(TAG, "广告奖励发放");
        // 发放奖励
        giveReward();
    }
});
```

#### 6.3 广告预加载示例

```java
public class AdPreloader {
    private static final String TAG = "AdPreloader";
    private static AdPreloader instance;
    private Map<String, AdRequest> preloadedAds = new HashMap<>();

    public static AdPreloader getInstance() {
        if (instance == null) {
            instance = new AdPreloader();
        }
        return instance;
    }

    public void preloadAd(String adUnitId, AdType adType) {
        AdRequest request = new AdRequest.Builder()
            .setAdUnitId(adUnitId)
            .setAdType(adType)
            .build();

        AdAggregator.getInstance().loadAd(request, new AdListener() {
            @Override
            public void onAdLoaded() {
                Log.d(TAG, "广告预加载成功: " + adUnitId);
                preloadedAds.put(adUnitId, request);
            }

            @Override
            public void onAdLoadFailed(String error) {
                Log.e(TAG, "广告预加载失败: " + adUnitId + ", error: " + error);
            }
        });
    }

    public void showPreloadedAd(String adUnitId) {
        AdRequest request = preloadedAds.get(adUnitId);
        if (request != null) {
            AdAggregator.getInstance().showAd();
            // 重新预加载
            preloadAd(adUnitId, request.getAdType());
        }
    }
}
```

#### 6.4 广告策略管理示例

```java
public class AdStrategyManager {
    private static final String TAG = "AdStrategyManager";
    private static AdStrategyManager instance;
    private Map<String, Double> platformEcpm = new HashMap<>();
    private Map<String, Integer> platformFillRate = new HashMap<>();

    public static AdStrategyManager getInstance() {
        if (instance == null) {
            instance = new AdStrategyManager();
        }
        return instance;
    }

    public void updatePlatformMetrics(String platform, double ecpm, int fillRate) {
        platformEcpm.put(platform, ecpm);
        platformFillRate.put(platform, fillRate);
        updateStrategy();
    }

    private void updateStrategy() {
        // 根据eCPM和填充率更新平台优先级
        List<String> priorityList = new ArrayList<>(platformEcpm.keySet());
        priorityList.sort((a, b) -> {
            double scoreA = calculateScore(platformEcpm.get(a), platformFillRate.get(a));
            double scoreB = calculateScore(platformEcpm.get(b), platformFillRate.get(b));
            return Double.compare(scoreB, scoreA);
        });

        AdAggregator.getInstance().setPlatformPriority(priorityList);
    }

    private double calculateScore(double ecpm, int fillRate) {
        // 根据业务需求计算平台得分
        return ecpm * 0.7 + fillRate * 0.3;
    }
}
```

#### 6.5 广告事件监听示例

```java
public class AdEventListener implements AdListener {
    private static final String TAG = "AdEventListener";
    private AnalyticsManager analyticsManager;

    public AdEventListener(AnalyticsManager analyticsManager) {
        this.analyticsManager = analyticsManager;
    }

    @Override
    public void onAdLoaded() {
        analyticsManager.logEvent("ad_loaded", null);
    }

    @Override
    public void onAdLoadFailed(String error) {
        Map<String, Object> params = new HashMap<>();
        params.put("error", error);
        analyticsManager.logEvent("ad_load_failed", params);
    }

    @Override
    public void onAdClicked() {
        analyticsManager.logEvent("ad_clicked", null);
    }

    @Override
    public void onAdOpened() {
        analyticsManager.logEvent("ad_opened", null);
    }

    @Override
    public void onAdClosed() {
        analyticsManager.logEvent("ad_closed", null);
    }

    @Override
    public void onAdRewarded() {
        analyticsManager.logEvent("ad_rewarded", null);
    }
}
```

#### 6.6 广告重试机制示例

```java
public class AdRetryManager {
    private static final String TAG = "AdRetryManager";
    private static final int MAX_RETRY_COUNT = 3;
    private static final long RETRY_DELAY = 1000; // 1秒

    private Map<String, Integer> retryCounts = new HashMap<>();
    private Handler handler = new Handler(Looper.getMainLooper());

    public void retryLoadAd(String adUnitId, AdRequest request, AdListener listener) {
        int count = retryCounts.getOrDefault(adUnitId, 0);
        if (count < MAX_RETRY_COUNT) {
            retryCounts.put(adUnitId, count + 1);
            handler.postDelayed(() -> {
                Log.d(TAG, "重试加载广告: " + adUnitId + ", 次数: " + (count + 1));
                AdAggregator.getInstance().loadAd(request, listener);
            }, RETRY_DELAY);
        } else {
            Log.e(TAG, "广告加载失败，已达到最大重试次数");
            listener.onAdLoadFailed("Max retry count reached");
            retryCounts.remove(adUnitId);
        }
    }

    public void resetRetryCount(String adUnitId) {
        retryCounts.remove(adUnitId);
    }
}
```

### 7. 更多场景示例

#### 7.1 多广告位管理示例

```java
public class AdSlotManager {
    private static final String TAG = "AdSlotManager";
    private static AdSlotManager instance;
    private Map<String, AdSlot> adSlots = new HashMap<>();

    public static AdSlotManager getInstance() {
        if (instance == null) {
            instance = new AdSlotManager();
        }
        return instance;
    }

    public void registerAdSlot(String slotId, AdType adType, ViewGroup container) {
        AdSlot slot = new AdSlot(slotId, adType, container);
        adSlots.put(slotId, slot);
    }

    public void loadAdSlot(String slotId) {
        AdSlot slot = adSlots.get(slotId);
        if (slot != null) {
            AdRequest request = new AdRequest.Builder()
                .setAdUnitId(slotId)
                .setAdType(slot.getAdType())
                .build();

            AdAggregator.getInstance().loadAd(request, new AdListener() {
                @Override
                public void onAdLoaded() {
                    slot.setAdLoaded(true);
                    Log.d(TAG, "广告位加载成功: " + slotId);
                }

                @Override
                public void onAdLoadFailed(String error) {
                    slot.setAdLoaded(false);
                    Log.e(TAG, "广告位加载失败: " + slotId + ", error: " + error);
                }
            });
        }
    }

    public void showAdSlot(String slotId) {
        AdSlot slot = adSlots.get(slotId);
        if (slot != null && slot.isAdLoaded()) {
            AdAggregator.getInstance().showAd();
        }
    }

    private static class AdSlot {
        private String slotId;
        private AdType adType;
        private ViewGroup container;
        private boolean isAdLoaded;

        public AdSlot(String slotId, AdType adType, ViewGroup container) {
            this.slotId = slotId;
            this.adType = adType;
            this.container = container;
        }

        public AdType getAdType() {
            return adType;
        }

        public boolean isAdLoaded() {
            return isAdLoaded;
        }

        public void setAdLoaded(boolean loaded) {
            isAdLoaded = loaded;
        }
    }
}
```

#### 7.2 广告频率控制示例

```java
public class AdFrequencyManager {
    private static final String TAG = "AdFrequencyManager";
    private static final long MIN_INTERVAL = 5 * 60 * 1000; // 5分钟
    private static AdFrequencyManager instance;
    private Map<String, Long> lastShowTime = new HashMap<>();

    public static AdFrequencyManager getInstance() {
        if (instance == null) {
            instance = new AdFrequencyManager();
        }
        return instance;
    }

    public boolean canShowAd(String adUnitId) {
        Long lastTime = lastShowTime.get(adUnitId);
        if (lastTime == null) {
            return true;
        }

        long currentTime = System.currentTimeMillis();
        long interval = currentTime - lastTime;
        
        if (interval >= MIN_INTERVAL) {
            return true;
        }

        Log.d(TAG, "广告展示频率限制: " + adUnitId + 
            ", 还需等待: " + (MIN_INTERVAL - interval) / 1000 + "秒");
        return false;
    }

    public void recordAdShown(String adUnitId) {
        lastShowTime.put(adUnitId, System.currentTimeMillis());
    }

    public void resetFrequency(String adUnitId) {
        lastShowTime.remove(adUnitId);
    }
}
```

#### 7.3 A/B测试实现示例

```java
public class ABTestManager {
    private static final String TAG = "ABTestManager";
    private static ABTestManager instance;
    private Map<String, ABTest> tests = new HashMap<>();

    public static ABTestManager getInstance() {
        if (instance == null) {
            instance = new ABTestManager();
        }
        return instance;
    }

    public void startTest(String testId, String groupA, String groupB) {
        ABTest test = new ABTest(testId, groupA, groupB);
        tests.put(testId, test);
    }

    public String getTestGroup(String testId) {
        ABTest test = tests.get(testId);
        if (test != null) {
            return test.getCurrentGroup();
        }
        return null;
    }

    public void recordTestResult(String testId, String group, double ecpm) {
        ABTest test = tests.get(testId);
        if (test != null) {
            test.recordResult(group, ecpm);
        }
    }

    private static class ABTest {
        private String testId;
        private String groupA;
        private String groupB;
        private String currentGroup;
        private Map<String, List<Double>> results = new HashMap<>();

        public ABTest(String testId, String groupA, String groupB) {
            this.testId = testId;
            this.groupA = groupA;
            this.groupB = groupB;
            this.currentGroup = Math.random() < 0.5 ? groupA : groupB;
        }

        public String getCurrentGroup() {
            return currentGroup;
        }

        public void recordResult(String group, double ecpm) {
            List<Double> groupResults = results.computeIfAbsent(group, k -> new ArrayList<>());
            groupResults.add(ecpm);
        }

        public double getAverageEcpm(String group) {
            List<Double> groupResults = results.get(group);
            if (groupResults == null || groupResults.isEmpty()) {
                return 0;
            }
            return groupResults.stream().mapToDouble(Double::doubleValue).average().orElse(0);
        }
    }
}
```

#### 7.4 性能监控示例

```java
public class AdPerformanceMonitor {
    private static final String TAG = "AdPerformanceMonitor";
    private static AdPerformanceMonitor instance;
    private Map<String, PerformanceMetrics> metrics = new HashMap<>();

    public static AdPerformanceMonitor getInstance() {
        if (instance == null) {
            instance = new AdPerformanceMonitor();
        }
        return instance;
    }

    public void startMonitoring(String adUnitId) {
        PerformanceMetrics metric = new PerformanceMetrics();
        metric.setStartTime(System.currentTimeMillis());
        metrics.put(adUnitId, metric);
    }

    public void recordLoadTime(String adUnitId) {
        PerformanceMetrics metric = metrics.get(adUnitId);
        if (metric != null) {
            metric.setLoadTime(System.currentTimeMillis() - metric.getStartTime());
        }
    }

    public void recordError(String adUnitId, String error) {
        PerformanceMetrics metric = metrics.get(adUnitId);
        if (metric != null) {
            metric.addError(error);
        }
    }

    public void reportMetrics(String adUnitId) {
        PerformanceMetrics metric = metrics.get(adUnitId);
        if (metric != null) {
            Log.d(TAG, "广告性能报告 - " + adUnitId + 
                "\n加载时间: " + metric.getLoadTime() + "ms" +
                "\n错误数: " + metric.getErrorCount() +
                "\n错误列表: " + metric.getErrors());
        }
    }

    private static class PerformanceMetrics {
        private long startTime;
        private long loadTime;
        private List<String> errors = new ArrayList<>();

        public void setStartTime(long startTime) {
            this.startTime = startTime;
        }

        public long getStartTime() {
            return startTime;
        }

        public void setLoadTime(long loadTime) {
            this.loadTime = loadTime;
        }

        public long getLoadTime() {
            return loadTime;
        }

        public void addError(String error) {
            errors.add(error);
        }

        public int getErrorCount() {
            return errors.size();
        }

        public List<String> getErrors() {
            return errors;
        }
    }
}
```

#### 7.5 错误处理策略示例

```java
public class AdErrorHandler {
    private static final String TAG = "AdErrorHandler";
    private static AdErrorHandler instance;
    private Map<String, ErrorStrategy> errorStrategies = new HashMap<>();

    public static AdErrorHandler getInstance() {
        if (instance == null) {
            instance = new AdErrorHandler();
        }
        return instance;
    }

    public void handleError(String adUnitId, String error) {
        ErrorStrategy strategy = errorStrategies.get(error);
        if (strategy != null) {
            strategy.execute(adUnitId);
        } else {
            Log.e(TAG, "未处理的错误: " + error);
        }
    }

    public void registerErrorStrategy(String error, ErrorStrategy strategy) {
        errorStrategies.put(error, strategy);
    }

    public interface ErrorStrategy {
        void execute(String adUnitId);
    }

    // 重试策略
    public static class RetryStrategy implements ErrorStrategy {
        private int maxRetries;
        private long retryDelay;

        public RetryStrategy(int maxRetries, long retryDelay) {
            this.maxRetries = maxRetries;
            this.retryDelay = retryDelay;
        }

        @Override
        public void execute(String adUnitId) {
            AdRetryManager.getInstance().retryLoadAd(adUnitId, 
                new AdRequest.Builder().setAdUnitId(adUnitId).build(),
                new AdListener() {
                    @Override
                    public void onAdLoaded() {
                        Log.d(TAG, "重试加载成功: " + adUnitId);
                    }

                    @Override
                    public void onAdLoadFailed(String error) {
                        Log.e(TAG, "重试加载失败: " + adUnitId + ", error: " + error);
                    }
                });
        }
    }

    // 降级策略
    public static class FallbackStrategy implements ErrorStrategy {
        private String fallbackAdUnitId;

        public FallbackStrategy(String fallbackAdUnitId) {
            this.fallbackAdUnitId = fallbackAdUnitId;
        }

        @Override
        public void execute(String adUnitId) {
            Log.d(TAG, "使用备用广告单元: " + fallbackAdUnitId);
            AdAggregator.getInstance().loadAd(
                new AdRequest.Builder().setAdUnitId(fallbackAdUnitId).build(),
                new AdListener() {
                    @Override
                    public void onAdLoaded() {
                        Log.d(TAG, "备用广告加载成功");
                    }

                    @Override
                    public void onAdLoadFailed(String error) {
                        Log.e(TAG, "备用广告加载失败: " + error);
                    }
                });
        }
    }
}